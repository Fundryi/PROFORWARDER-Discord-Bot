require('dotenv').config({ path: './config/.env' });

module.exports = {
  botToken: process.env.BOT_TOKEN,
  debugMode: false, // Set to true to enable debug logging and test commands
  
  // Enhanced Format Conversion Settings (streamlined system)
  useSliceFormatConverter: true,  // Enhanced slice-based conversion (PRIMARY METHOD - recommended)
  useAIFormatConverter: false,    // AI-powered conversion (FALLBACK ONLY - for future use)
  
  // Bot message forwarding control
  forwardBotMessages: true, // Set to false to ignore messages from other bots
  
  // Forward configurations - Automatically populated by bot via /proforward commands
  // Do not manually edit this array - use Discord commands instead
  forwardConfigs: [],

  // Startup log maintenance (optional)
  // Controls background validation/cleanup of message_logs on startup
  startupLogMaintenance: {
    enabled: true,
    batchSize: 200,
    maxRuntimeMs: 2 * 60 * 1000, // 2 minutes max per startup run
    delayBetweenBatchesMs: 250,
    retentionDays: 180, // 6 months
    retentionAction: 'skip' // 'skip' | 'delete'
  },

  // Web admin panel settings (phase 0 foundation only)
  webAdmin: {
    enabled: process.env.WEB_ADMIN_ENABLED === 'true',
    baseUrl: process.env.WEB_ADMIN_BASE_URL || '',
    port: parseInt(process.env.WEB_ADMIN_PORT || '3001', 10),
    authMode: (process.env.WEB_ADMIN_AUTH_MODE || (process.env.WEB_ADMIN_LOCAL_BYPASS_AUTH === 'true' ? 'local' : 'oauth'))
      .toLowerCase(),
    sessionTtlHours: parseInt(process.env.WEB_ADMIN_SESSION_TTL_HOURS || '24', 10),
    trustProxy: process.env.WEB_ADMIN_TRUST_PROXY === 'true',
    debug: process.env.WEB_ADMIN_DEBUG === 'true',
    sessionSecret: process.env.WEB_ADMIN_SESSION_SECRET || '',
    oauthClientId: process.env.WEB_ADMIN_DISCORD_CLIENT_ID || '',
    oauthClientSecret: process.env.WEB_ADMIN_DISCORD_CLIENT_SECRET || '',
    oauthRedirectUri: process.env.WEB_ADMIN_DISCORD_REDIRECT_URI || '',
    oauthScopes: process.env.WEB_ADMIN_DISCORD_SCOPES || 'identify guilds',
    botInviteRedirectUri: process.env.BOT_INVITE_REDIRECT_URI || '',
    localAllowedHosts: (process.env.WEB_ADMIN_LOCAL_ALLOWED_HOSTS ||
      process.env.WEB_ADMIN_LOCAL_BYPASS_ALLOWED_HOSTS ||
      'localhost,127.0.0.1,::1')
      .split(',')
      .map(host => host.trim().toLowerCase())
      .filter(Boolean),
    localAllowedIps: (process.env.WEB_ADMIN_LOCAL_ALLOWED_IPS ||
      process.env.WEB_ADMIN_LOCAL_BYPASS_ALLOWED_IPS ||
      '')
      .split(',')
      .map(ip => ip.trim())
      .filter(Boolean),
    allowedRoleIds: (process.env.WEB_ADMIN_ALLOWED_ROLE_IDS || '')
      .split(',')
      .map(roleId => roleId.trim())
      .filter(Boolean)
  },
  
  // Auto-publish channels configuration
  // Channels configured for automatic publishing of announcements
  // Automatically populated by bot via /proforward auto-publish commands
  autoPublishChannels: {},
  
  // Discord integration settings
  discord: {
    // Cached invite links for source headers (automatically managed)
    // Do not manually edit - the bot manages these automatically
    cachedInvites: {
      // Example: "123456789": { invite: "https://discord.gg/abc123", isVanity: false, expiresAt: null }
    }
  },
  
  // Reader Bot Configuration (optional)
  readerBot: {
    enabled: process.env.READER_BOT_ENABLED === 'true',
    token: process.env.READER_BOT_TOKEN
  },
  
  // Telegram integration (optional)
  telegram: {
    enabled: false, // Set to true to enable Telegram integration
    botToken: process.env.TELEGRAM_BOT_TOKEN,
    apiUrl: process.env.TELEGRAM_API_URL || 'https://api.telegram.org',
    hideSourceHeader: false, // Set to true to disable Discord source headers in Telegram messages
    smartLinkPreviews: true, // Smart link preview behavior: allow previews when Discord has images, disable for text-only messages
    
    // Smart Caption Length Management (Anti-Spam Solution)
    captionLengthLimit: 900, // Safe caption length limit (Telegram limit is 1024, we use 900 for safety)
    textLengthLimit: 4000, // Safe text message length limit (Telegram limit is 4096, we use 4000 for safety)
    splitIndicator: '...(continued)', // Text to indicate message continues in next message
    captionSplitStrategy: 'smart' // 'smart' = intelligent splitting, 'separate' = send media separately (header + full text)
  },
  
  // AI Integration for translation and content optimization
  ai: {
    enabled: false, // Set to true to enable AI features

    // Provider configurations (API keys from .env file)
    // Currently supported providers: gemini (primary), google (fallback)
    providers: {
      // Google Gemini (FREEMIUM - Free tier available)
      // Best for: Advanced AI format conversion and translations
      // Cost: Free tier available, pay per token after limits
      // This is the PRIMARY and RECOMMENDED provider
      gemini: {
        apiKey: process.env.GEMINI_API_KEY,
        model: 'gemini-2.0-flash-exp',
        maxTokens: 2048,
        temperature: 0 // Conservative for formatting precision
      },

      // Google Translate (OPTIONAL - Fallback provider)
      // Best for: Simple translations when Gemini is unavailable
      // Note: Requires Google Cloud API key with Translation API enabled
      google: {
        apiKey: process.env.GOOGLE_TRANSLATE_API_KEY
      }
    },

    // Translation settings
    translation: {
      enabled: true, // Enable translation features
      defaultProvider: 'gemini', // Primary provider (recommended)
      cacheTranslations: true, // Cache translations to reduce API costs
      maxCacheAge: 24 * 60 * 60 * 1000, // 24 hours in milliseconds
      fallbackProvider: 'google' // Fallback if primary provider fails
    },
    
    // Content optimization settings
    optimization: {
      defaultLevel: 'enhanced', // 'basic', 'enhanced', 'custom'
      preserveEmojis: true,
      preserveMentions: true,
      preserveLinks: true,
      maxOptimizationLength: 2000
    }
  }
};
